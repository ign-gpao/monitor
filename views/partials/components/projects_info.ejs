<!-- views/partials/projects_info.ejs -->
<!-- Content Column -->
<div class="col-lg-6 mb-4">

    <!-- Project Card Example -->
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-dark">Avancement des projets</h6>
      </div>
      <div id="no-elements" class="card-body">
          <% projects.forEach(function( project ){ %>
              <h4 class="small font-weight-bold"><a class="text-secondary" href="<%= base %>/project/<%= project.id_project %>"><%= project.name %><span id="topbar_project_value_<%= project.id_project %>" class="float-right text-secondary">0%</span></a></h4>
              <div class="progress mb-4">
                  <div id="topbar_project_pg_<%= project.id_project %>" class="progress-bar bg-primary" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
          <% }) %>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function() {  
      <% projects.forEach(function( project ){ %>
        var avancement = percent(<%= project.done %>+<%= project.failed %>, <%= project.total %>)
        $('#topbar_project_pg_<%= project.id_project %>').attr('style', 'width: '+percent(<%= project.done %>+<%= project.failed %>, <%= project.total %>)+"%");
        $('#topbar_project_pg_<%= project.id_project %>').text(avancement+"%");
        $('#topbar_project_value_<%= project.id_project %>').text("<%= project.done %> traités, <%= project.failed %> échoués, <%= project.running %> en cours, <%= project.waiting %> en attente sur <%= project.total %> au total");
        if (<%=project.done%>==<%=project.total%>) {
          $('#topbar_project_pg_<%= project.id_project %>').addClass('bg-success');
        }
        if (<%=project.failed%>==<%=project.total%>) { 
          $('#topbar_project_pg_<%= project.id_project %>').addClass('bg-danger');
        }
        if (<%=project.running%>>0) {
          $('#topbar_project_pg_<%= project.id_project %>').addClass('bg-warning');
        } 
        if (<%=project.failed%>>0 && avancement==100) {
          console.log('okkk', avancement);
          $('#topbar_project_pg_<%= project.id_project %>').addClass('bg-secondary');
        }
      <% }) %>
      <% if (projects.length==0) { %>
          $('#no-elements').append( "<strong>Aucun projet dans la base</strong>" );
        <% } %>
    } );
    </script>